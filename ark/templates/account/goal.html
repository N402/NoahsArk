{%- extends 'layout.html' %}

{%- block static %}
<link rel="stylesheet" href="{{ url_for('static', filename='components/tooltipster/css/tooltipster.css') }}" type="text/css" />
<link rel="stylesheet" href="{{ url_for('static', filename='styles/account/goals.css') }}" type="text/css" />
{%- endblock %}

{%- block main %}
<div class="main" id="account-goal">
  <div class="goal pull-left">
    <div class="banner-image" style="background-image: url('{{ goal.image.get_thumbnail_limit_width(350) }}')">
      <span class="avatar" style="background-image: url('{{ goal.author.avatar_url }}')"></span>
    </div>
    <div class="goal-info">
      <div class="title">{{ goal.title }}</div>
      <div class="state-like">
        <span class="state">{{ goal.display_state() }}</span>
        <span class="like"><i class="iconfont icon-small icon-xiai"></i> {{ goal.like_count }}</span>
      </div>
      <div class="goal-description">
        {{ goal.description }}
      </div>
      <div class="btn-group center">
        <a href="#" class="btn btn-success">{{ _('Complete it') }}</a>
        <a href="#" class="btn">{{ _('Give up') }}</a>
      </div>
    </div>
  </div>

  <div class="activity-container pull-left">
    <div class="create-activity" id="create-activity">
      <form action="{{ url_for('goal.activity', gid=goal.id) }}" method="POST" id="createActivityForm">
        {{ form.csrf_token }}
        {{ form.activity() }}
        {{ form.image_url(style="display:none") }}
        {{ form.image_name(style="display:none") }}
        <div class="tool">
          <a href="javascript:void(0);" id="upImage">图片</a>
          <span><img src="" id="preview" /></span>
          <button type="button" onclick="updateAvtivity()" id="submitBtn" class="btn btn-success pull-right">{{ _('Publish') }}</button>
        </div>
      </form>
    </div>
    <div class="activities" id="activities">
      {% for each in activities %}
      <div class="activity">
        {{ each.activity }} 
        {% if each.image %}
        <div class="activity-image">
          <img src="{{ each.image.get_thumbnail(150, 150) }}" />
        </div>
        {% endif %}
        <div class="activity-time">{{ each.created | friendly_time('Y年M月d日 HH:mm') }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
{%- endblock %}
{%- block scripts %}
<script src="{{ url_for('static', filename='components/jquery/dist/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='components/jquery-form/jquery.form.js') }}"></script>
<script src="{{ url_for('static', filename='components/jquery-validation/dist/jquery.validate.min.js') }}"></script>
<script src="{{ url_for('static', filename='components/tooltipster/js/jquery.tooltipster.min.js') }}"></script>
<script src="{{ url_for('static', filename='components/plupload/js/plupload.full.min.js') }}"></script>
<script src="{{ url_for('static', filename='components/qiniu-js-sdk/src/qiniu.js') }}"></script> <script src="{{ url_for('static', filename='scripts/account/activity.js')}}"></script>
{%- endblock %}
